{
	"info": {
		"_postman_id": "b961ec68-c28b-4594-9441-77bf5149101e",
		"name": "Parabank",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "3768658"
	},
	"item": [
		{
			"name": "Login",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 2xx\", function () {",
							"    pm.expect(pm.response.code).to.be.within(200, 299);",
							"});",
							"",
							"pm.test(\"Response body is not empty\", function () {",
							"    pm.expect(pm.response.text(), \"Response body should not be empty\").to.be.a(\"string\").and.not.empty;",
							"});",
							"",
							"try {",
							"    var jsonObject = xml2Json(pm.response.text());",
							"    var customerId = null;",
							"    if (jsonObject && jsonObject.customer && jsonObject.customer.id) {",
							"        customerId = jsonObject.customer.id;",
							"    }",
							"    if (customerId) {",
							"        pm.collectionVariables.set(\"myCustomerId\", customerId);",
							"    }",
							"} catch (e) { /* ignore */ }"
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"request": {
				"auth": {
					"type": "noauth"
				},
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{baseURL}}/login/:username/:password",
					"host": [
						"{{baseURL}}"
					],
					"path": [
						"login",
						":username",
						":password"
					],
					"variable": [
						{
							"key": "username",
							"value": "test"
						},
						{
							"key": "password",
							"value": "test"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "Account Overview",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 2xx\", function () {",
							"    pm.expect(pm.response.code).to.be.within(200, 299);",
							"});",
							"",
							"pm.test(\"Extract and save customer id from XML\", function () {",
							"    const body = pm.response.text();",
							"    pm.expect(body, \"Response body should not be empty\").to.be.a(\"string\").and.not.empty;",
							"",
							"    var jsonObject = xml2Json(body);",
							"",
							"    let myCustomerId = null;",
							"    let customerId = null;",
							"    try {",
							"        let account = jsonObject.accounts && jsonObject.accounts.account;",
							"        if (Array.isArray(account)) {",
							"            account = account[0];",
							"        }",
							"        if (account && account.id) {",
							"            if (typeof account.id === \"string\") {",
							"                customerId = account.id;",
							"            } else if (typeof account.id === \"object\" && typeof account.customerId[\"#text\"] === \"string\") {",
							"                customerId = account.id[\"#text\"];",
							"            }",
							"        }",
							"    } catch (e) { /* noop */ }",
							"",
							"    pm.expect(customerId, \"customer.id should be present\").to.be.a(\"string\").and.not.empty;",
							"",
							"    pm.collectionVariables.set(\"myCustomerId\", customerId);",
							"",
							"});"
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							""
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{baseURL}}/customers/{{myAccountId}}/accounts",
					"host": [
						"{{baseURL}}"
					],
					"path": [
						"customers",
						"{{myAccountId}}",
						"accounts"
					]
				}
			},
			"response": []
		},
		{
			"name": "Create New Account",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 2xx\", function () {",
							"    pm.expect(pm.response.code).to.be.within(200, 299);",
							"});",
							"",
							"pm.test(\"Extract and store new account id from XML\", function () {",
							"    const xml = pm.response.text();",
							"    pm.expect(xml, \"Response body should not be empty\").to.be.a(\"string\").and.not.empty;",
							"",
							"    var obj = xml2Json(xml);",
							"",
							"    let accountId = null;",
							"    try {",
							"        const idNode = obj && obj.account && obj.account.id;",
							"        if (typeof idNode === \"string\") {",
							"            accountId = idNode;",
							"        } else if (idNode && typeof idNode === \"object\" && typeof idNode[\"#text\"] === \"string\") {",
							"            accountId = idNode[\"#text\"];",
							"        }",
							"    } catch (e) { /* no-op */ }",
							"",
							"    pm.expect(accountId, \"account id should be present\").to.be.a(\"string\").and.not.empty;",
							"",
							"    pm.collectionVariables.set(\"newAccountId\", accountId);",
							"});",
							"",
							"pm.test(\"accountId saved to collection variables\", function () {",
							"    pm.expect(pm.collectionVariables.get(\"newAccountId\")).to.be.a(\"string\").that.is.not.empty;",
							"});"
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [],
				"url": {
					"raw": "{{baseURL}}/createAccount?customerId={{myAccountId}}&newAccountType=0&fromAccountId={{myCustomerId}}",
					"host": [
						"{{baseURL}}"
					],
					"path": [
						"createAccount"
					],
					"query": [
						{
							"key": "customerId",
							"value": "{{myAccountId}}"
						},
						{
							"key": "newAccountType",
							"value": "0"
						},
						{
							"key": "fromAccountId",
							"value": "{{myCustomerId}}"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "Transfer",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Content-Type header is present\", function () {",
							"    pm.response.to.have.header(\"Content-Type\");",
							"});",
							"pm.test(\"Content-Type header is application/xml\", function () {",
							"    pm.expect(pm.response.headers.get(\"Content-Type\")).to.include(\"application/xml\");",
							"});"
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [],
				"url": {
					"raw": "{{baseURL}}/transfer?fromAccountId={{myCustomerId}}&toAccountId={{newAccountId}}&amount=111",
					"host": [
						"{{baseURL}}"
					],
					"path": [
						"transfer"
					],
					"query": [
						{
							"key": "fromAccountId",
							"value": "{{myCustomerId}}"
						},
						{
							"key": "toAccountId",
							"value": "{{newAccountId}}"
						},
						{
							"key": "amount",
							"value": "111"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "Get Transactions",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 2xx\", function () {",
							"    pm.expect(pm.response.code).to.be.within(200, 299);",
							"});",
							"",
							"pm.test(\"Response body is not empty\", function () {",
							"    pm.expect(pm.response.text(), \"Response body should not be empty\").to.be.a(\"string\").and.not.empty;",
							"});",
							"",
							"try {",
							"    var jsonObject = xml2Json(pm.response.text());",
							"    var transactions = null;",
							"    if (jsonObject && jsonObject.transactions && jsonObject.transactions.transaction) {",
							"        transactions = jsonObject.transactions.transaction;",
							"    }",
							"    pm.expect(transactions, \"Transactions should be present\").to.exist;",
							"} catch (e) { /* ignore */ }"
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{baseURL}}/accounts/{{newAccountId}}/transactions",
					"host": [
						"{{baseURL}}"
					],
					"path": [
						"accounts",
						"{{newAccountId}}",
						"transactions"
					]
				}
			},
			"response": []
		},
		{
			"name": "Request Loan",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 2xx\", function () {",
							"    pm.expect(pm.response.code).to.be.within(200, 299);",
							"});",
							"",
							"pm.test(\"Response body is not empty\", function () {",
							"    pm.expect(pm.response.text(), \"Response body should not be empty\").to.be.a(\"string\").and.not.empty;",
							"});",
							"",
							"try {",
							"    var jsonObject = xml2Json(pm.response.text());",
							"    var loanId = null;",
							"    if (jsonObject && jsonObject.loanResponse && jsonObject.loanResponse.id) {",
							"        loanId = jsonObject.loanResponse.id;",
							"    }",
							"    if (loanId) {",
							"        pm.collectionVariables.set(\"loanId\", loanId);",
							"    }",
							"} catch (e) { /* ignore */ }"
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [],
				"url": {
					"raw": "{{baseURL}}/requestLoan?customerId={{myAccountId}}&amount=111&downPayment=1&fromAccountId={{newAccountId}}",
					"host": [
						"{{baseURL}}"
					],
					"path": [
						"requestLoan"
					],
					"query": [
						{
							"key": "customerId",
							"value": "{{myAccountId}}"
						},
						{
							"key": "amount",
							"value": "111"
						},
						{
							"key": "downPayment",
							"value": "1"
						},
						{
							"key": "fromAccountId",
							"value": "{{newAccountId}}"
						}
					]
				}
			},
			"response": []
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"packages": {},
				"requests": {},
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"packages": {},
				"requests": {},
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"key": "baseURL",
			"value": "https://parabank.parasoft.com/parabank/services/bank"
		},
		{
			"key": "myAccountId",
			"value": "12545"
		},
		{
			"key": "myCustomerId",
			"value": "13788"
		},
		{
			"key": "newAccountId",
			"value": "17673"
		},
		{
			"key": "transfer_amount",
			"value": ""
		},
		{
			"key": "transfer_fromAccountId",
			"value": ""
		},
		{
			"key": "transfer_toAccountId",
			"value": ""
		}
	]
}